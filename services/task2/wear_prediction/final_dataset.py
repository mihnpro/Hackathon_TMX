"""
prepare_final_dataset.py
–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–• –î–õ–Ø –ú–û–î–ï–õ–ò
–£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–µ–µ, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ
"""

import pandas as pd
import os

# ============== 1. –ó–ê–ì–†–£–ñ–ê–ï–ú ==============
print("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")
df = pd.read_csv('data/processed/train_dataset.csv')

print(f"–ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä: {df.shape}")
print(f"–ò—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: {df.columns.tolist()}")

# ============== 2. –£–î–ê–õ–Ø–ï–ú –õ–ò–®–ù–ï–ï ==============
print("\n" + "="*50)
print("üßπ –£–î–ê–õ–Ø–ï–ú –õ–ò–®–ù–ò–ï –ö–û–õ–û–ù–ö–ò")
print("="*50)

columns_to_drop = [
    'wheel_id',              # ID –∫–æ–ª–µ—Å–∞ - –Ω–µ –ø—Ä–∏–∑–Ω–∞–∫
    'locomotive_number',     # –ù–æ–º–µ—Ä –ª–æ–∫–æ–º–æ—Ç–∏–≤–∞ - –Ω–µ –ø—Ä–∏–∑–Ω–∞–∫
    'first_repair_date',     # –î–∞—Ç–∞ - –º–æ–¥–µ–ª—å –Ω–µ –ø–æ–π–º–µ—Ç
    'last_repair_date'       # –î–∞—Ç–∞ - –º–æ–¥–µ–ª—å –Ω–µ –ø–æ–π–º–µ—Ç
]

df = df.drop(columns=columns_to_drop)

print(f"–£–¥–∞–ª–µ–Ω–æ –∫–æ–ª–æ–Ω–æ–∫: {len(columns_to_drop)}")
print(f"–û—Å—Ç–∞–ª–æ—Å—å –∫–æ–ª–æ–Ω–æ–∫: {df.shape[1]}")
print(f"–ö–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è: {df.columns.tolist()}")

# ============== 3. –ü–†–û–í–ï–†–Ø–ï–ú steel_num ==============
print("\n" + "="*50)
print("üîß –ü–†–û–í–ï–†–ö–ê steel_num")
print("="*50)

print(f"–¢–∏–ø –î–û: {df['steel_num'].dtype}")
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ–º —Å—Ç—Ä–æ–∫–æ–π
df['steel_num'] = df['steel_num'].astype(str)
print(f"–¢–∏–ø –ü–û–°–õ–ï: {df['steel_num'].dtype}")

# ============== 4. –ü–†–û–í–ï–†–Ø–ï–ú –ü–†–û–ü–£–°–ö–ò ==============
print("\n" + "="*50)
print("üîç –ü–†–û–í–ï–†–ö–ê –ü–†–û–ü–£–°–ö–û–í")
print("="*50)

print(df.isnull().sum())
print(f"\n–í—Å–µ–≥–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤: {df.isnull().sum().sum()}")

# ============== 5. –ü–†–û–í–ï–†–Ø–ï–ú –î–£–ë–õ–ò–ö–ê–¢–´ ==============
print("\n" + "="*50)
print("üîÑ –ü–†–û–í–ï–†–ö–ê –î–£–ë–õ–ò–ö–ê–¢–û–í")
print("="*50)

duplicates = df.duplicated().sum()
print(f"–î—É–±–ª–∏–∫–∞—Ç–æ–≤ —Å—Ç—Ä–æ–∫: {duplicates}")
if duplicates > 0:
    df = df.drop_duplicates()
    print(f"‚úÖ –î—É–±–ª–∏–∫–∞—Ç—ã —É–¥–∞–ª–µ–Ω—ã, –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä: {df.shape}")

# ============== 6. –ü–†–û–í–ï–†–Ø–ï–ú –¢–ò–ü–´ ==============
print("\n" + "="*50)
print("üìä –¢–ò–ü–´ –î–ê–ù–ù–´–•")
print("="*50)
print(df.dtypes)

# ============== 7. –°–û–•–†–ê–ù–Ø–ï–ú –§–ò–ù–ê–õ–¨–ù–£–Æ –í–ï–†–°–ò–Æ ==============
print("\n" + "="*50)
print("üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï")
print("="*50)

output_path = 'data/processed/train_dataset_final.csv'
df.to_csv(output_path, index=False)
print(f"‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤: {output_path}")
print(f"–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: {df.shape}")
print(f"–§–∏–Ω–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ ({len(df.columns)}):")
for i, col in enumerate(df.columns, 1):
    print(f"  {i}. {col}")

# ============== 8. –ü–û–ö–ê–ó–´–í–ê–ï–ú –ü–†–ò–ú–ï–† ==============
print("\n" + "="*50)
print("üìã –ü–†–ò–ú–ï–† –î–ê–ù–ù–´–• (–ø–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏)")
print("="*50)
print(df.head(3))

# ============== 9. –°–ü–†–ê–í–ö–ê –î–õ–Ø –ú–û–î–ï–õ–ò ==============
print("\n" + "="*50)
print("ü§ñ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –î–õ–Ø –ú–û–î–ï–õ–ò")
print("="*50)
print("""
–ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ –º–æ–¥–µ–ª–∏):
  1. locomotive_series
  2. depo  
  3. steel_num

–ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:
  4. mileage_start
  5. total_repairs
  6. repair_type_1
  7. repair_type_2
  8. repair_type_3
  9. turning_count
  10. unique_service_dates

–¶–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è:
  11. wear_intensity

–í–°–ï–ì–û: 10 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ + 1 —Ü–µ–ª–µ–≤–∞—è = 11 –∫–æ–ª–æ–Ω–æ–∫
""")